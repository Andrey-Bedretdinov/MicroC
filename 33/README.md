# Объяснение кода: Генерация сигнала с частотой 1 кГц в режиме CTC

Этот код реализует генерацию сигнала с частотой 1 кГц на выходе `PB1` (вывод `OC1A`) с использованием таймера `Timer1` в режиме CTC (Clear Timer on Compare Match). Режим CTC позволяет сбрасывать счетчик таймера при достижении заданного значения в регистре `OCR1A`, что и используется для формирования сигнала.

---

## Настройка частоты и режима работы

### Основные параметры

1. Тактовая частота микроконтроллера: F_CPU = 8 МГц
2. Предделитель таймера: TIMER_PRESCALER = 8
3. Частота выходного сигнала: OUTPUT_FREQUENCY = 1000 Гц
4. Формула расчета OCR1A: OCR1A = (F_CPU / (2 * TIMER_PRESCALER * OUTPUT_FREQUENCY)) - 1

Подставляя значения: OCR1A = (8 000 000 / (2 * 8 * 1000)) - 1 = 499

---

## Настройка портов

### Конфигурация `PB1` как выхода

```c
DDRB |= (1 << PB1);
```

- Устанавливает пин `PB1` как выходной, чтобы он мог использоваться для генерации сигнала на выводе `OC1A`.

---

## Настройка таймера

### Регистр `TCCR1A`

```c
TCCR1A |= (1 << COM1A0);
```

- **`COM1A0`**: Включает режим переключения состояния выхода `OC1A` при совпадении таймера с регистром `OCR1A` (Toggle OC1A on Compare Match).

---

### Регистр `TCCR1B`

```c
TCCR1B |= (1 << CS11) | (1 << WGM12);
```

1. **`CS11`**: Устанавливает предделитель таймера в 8.
2. **`WGM12`**: Включает режим CTC, при котором таймер сбрасывается в `0` при совпадении с `OCR1A`.

---

### Регистр `OCR1A`

```c
OCR1A = (F_CPU / (2 * TIMER_PRESCALER * OUTPUT_FREQUENCY)) - 1;
```

- Устанавливает значение для совпадения таймера с учетом частоты процессора, предделителя и желаемой частоты сигнала.

---

## Основной цикл

```c
while (1) {
    // Таймер работает автоматически, обеспечивая генерацию сигнала
}
```

- Основной цикл пуст, так как управление сигналом полностью выполняется аппаратно с использованием таймера.

---

## Использованные регистры

1. **`DDRB`**: Настройка пина `PB1` как выходного.
2. **`TCCR1A`**:
   - Бит `COM1A0`: Включает переключение состояния выхода `OC1A` при совпадении.
3. **`TCCR1B`**:
   - Бит `WGM12`: Включает режим CTC.
   - Бит `CS11`: Устанавливает предделитель в 8.
4. **`OCR1A`**:
   - Хранит значение, при котором происходит совпадение и сброс таймера.

---

## Режим CTC: Принцип работы

1. Счет таймера: Таймер считает от `0` до значения `OCR1A`.
2. Сброс таймера: При достижении значения `OCR1A` таймер автоматически сбрасывается в `0`.
3. Переключение состояния выхода `OC1A`: При каждом совпадении состояние пина `PB1` переключается (лог. 0 → лог. 1 или лог. 1 → лог. 0).

---

## Итоговая частота сигнала

Формула: F_output = F_CPU / (2 * TIMER_PRESCALER * (OCR1A + 1))  
Подставляем значения: F_output = 8 000 000 / (2 * 8 * (499 + 1)) = 1000 Гц

---

## Вывод

1. **Генерация сигнала**: На пине `PB1` (`OC1A`) формируется прямоугольный сигнал с частотой 1 кГц.
2. **Аппаратное управление**: Таймер в режиме CTC автоматически сбрасывается и переключает состояние выхода без участия основной программы.
3. **Применение**: Используется для генерации тактовых сигналов, управления светодиодами или других приложений, где требуется стабильная частота.  