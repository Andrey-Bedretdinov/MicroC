// Генерация сигнала частотой 1 кГц с использованием режима работы таймера CTC
// Вывод сигнала осуществляется на вывод PB1/OC1A (pin 13).
//
// ВАЖНО! Установите бит CLKDIV8 (Unprogrammed) для работы контроллера на частоте 8 МГц.

#include <avr/io.h>

#define F_CPU 8000000UL // Частота микроконтроллера в герцах
#define TIMER_PRESCALER 8 // Предделитель таймера
#define OUTPUT_FREQUENCY 1000 // Желаемая частота выходного сигнала в герцах

int main() {
    // Настраиваем вывод PB1 (OC1A) как выход
    DDRB |= (1 << PB1);

    // Включаем переключение состояния вывода OC1A по совпадению (Toggle OC1A on Compare Match)
    TCCR1A |= (1 << COM1A0);

    // Устанавливаем предделитель таймера в 8 и режим работы CTC (Clear Timer on Compare Match)
    TCCR1B |= (1 << CS11) | (1 << WGM12);

    // Рассчитываем значение OCR1A для генерации сигнала заданной частоты
    // Формула: OCR1A = (F_CPU / (2 * TIMER_PRESCALER * OUTPUT_FREQUENCY)) - 1
    OCR1A = (F_CPU / (2 * TIMER_PRESCALER * OUTPUT_FREQUENCY)) - 1;

    // Бесконечный цикл (основной код не выполняет дополнительных действий)
    while (1) {
        // Таймер работает автоматически, обеспечивая генерацию сигнала
    }
}
