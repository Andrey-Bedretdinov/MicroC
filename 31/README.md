# Объяснение кода: Использование внешних прерываний (PCINT) для управления семисегментным индикатором

Этот код реализует управление семисегментным индикатором через внешний прерывания по изменению состояния входов порта `PD`. Состояние кнопок, подключенных к порту `PD`, определяет, какие сегменты индикатора на порту `PB` будут включены.

---

## Настройка системы

### Инициализация портов

#### Функция `initialize_ports`

```c
void initialize_ports() {
    DDRB = 0xFF; // Порт B настроен как выход (управление индикатором)
    DDRD = 0x00; // Порт D настроен как вход (кнопки)

    // Включаем внутренние подтягивающие резисторы на PD7..PD4
    PORTD = 0b11110000;
}
```

1. **`PORTB`**:
    - Используется для управления семисегментным индикатором.
    - Настроен как выход (`DDRB = 0xFF`).

2. **`PORTD`**:
    - Используется для считывания состояния кнопок.
    - Настроен как вход (`DDRD = 0x00`).
    - Подключены внутренние подтягивающие резисторы для кнопок на `PD7..PD4`.

---

### Настройка прерываний

#### Функция `initialize_PCINT`

```c
void initialize_PCINT() {
    sei(); // Включаем глобальные прерывания

    PCICR |= (1 << PCIE2);  // Разрешаем прерывания для группы PCINT2 (порт D)
    PCMSK2 = 0xFF;          // Активируем прерывания для всех пинов порта D
}
```

1. **`sei()`**:
    - Включает глобальные прерывания.

2. **`PCICR`** (Pin Change Interrupt Control Register):
    - Бит `PCIE2`: Разрешает прерывания по изменению состояния на пинах порта `PD` (группа PCINT2).

3. **`PCMSK2`** (Pin Change Mask Register 2):
    - Устанавливает, для каких конкретных пинов в порту `PD` будут срабатывать прерывания.
    - Значение `0xFF` включает прерывания для всех 8 пинов (`PD7..PD0`).

---

## Обработка прерываний

### Обработчик `ISR(PCINT2_vect)`

```c
ISR(PCINT2_vect) {
    uint8_t pin;
    for (pin = 0; pin < 8; ++pin) {
        if ((PIND >> pin) & 1) {
            PORTB &= ~(1 << pin); // Кнопка не нажата, сегмент выключается
        } else {
            PORTB |= (1 << pin);  // Кнопка нажата, сегмент включается
        }
    }
}
```

1. **Чтение состояния пинов порта `PD`**:
    - Проверяется каждый пин от `PD0` до `PD7`.
    - Если кнопка не нажата (`лог. 1`), соответствующий сегмент индикатора выключается.
    - Если кнопка нажата (`лог. 0`), сегмент включается.

2. **Управление индикатором через `PORTB`**:
    - Состояние кнопок непосредственно отражается на семисегментном индикаторе.

---

## Основной цикл

### Функция `main`

```c
int main() {
    initialize_ports();  // Инициализация портов
    initialize_PCINT();  // Инициализация внешних прерываний

    while (1) {
        // Основной цикл не содержит кода, всё обрабатывается в прерывании
    }
}
```

- Основной цикл остается пустым, так как управление индикатором полностью реализовано через обработчик прерывания.

---

## Использованные регистры

1. **`DDRB`**: Настройка направления порта `PB` как выходного.
2. **`PORTB`**: Управление состояниями сегментов семисегментного индикатора.
3. **`DDRD`**: Настройка направления порта `PD` как входного.
4. **`PORTD`**: Включение внутренних подтягивающих резисторов для кнопок на порту `PD`.
5. **`PCICR`**:
    - Бит `PCIE2`: Разрешает прерывания по изменению состояния на порту `PD`.
6. **`PCMSK2`**:
    - Определяет, для каких пинов порта `PD` разрешены прерывания.
7. **`PIND`**:
    - Используется для чтения состояния пинов порта `PD`.

---

## Итоговая схема работы

1. **Кнопки на порту `PD`**:
    - Нажатие кнопки (`лог. 0`) активирует соответствующий сегмент индикатора.
    - Отпускание кнопки (`лог. 1`) деактивирует сегмент.

2. **Прерывания `PCINT2`**:
    - Срабатывают при любом изменении состояния на входах `PD0..PD7`.
    - Изменения обрабатываются в обработчике `ISR(PCINT2_vect)`.

3. **Семисегментный индикатор на `PORTB`**:
    - Состояние каждого сегмента определяется соответствующим пином порта `PD`.

---

## Пример работы

1. Если нажата кнопка на `PD0`, включается сегмент, подключенный к `PB0`.
2. Если отпущена кнопка на `PD1`, сегмент на `PB1` выключается.
3. Изменения отображаются в реальном времени благодаря прерываниям.